# 第32章 実践：フルスタック Web アプリ (Leptos)

## この章のゴール
- `Leptos` が、サーバーサイドとクライアントサイドの両方を Rust で記述できるフルスタックフレームワークであることを理解する。
- `cargo-leptos` を使って、`Leptos` プロジェクトの雛形を作成し、開発サーバーを起動できる。
- コンポーネント (`#[component]`) とリアクティブな状態管理（シグナル）の基本的な使い方を理解する。
- 簡単なカウンターアプリケーションを実装し、サーバーサイドレンダリング (SSR) とクライアントサイドのインタラクティビティを体験する。

---

## 32.1 なぜこれが必要か？ Rust で Web のフロントエンドまで
これまで `axum` を使ってサーバーサイド API を構築しましたが、Web の世界はフロントエンド（ブラウザで動作する UI）と密接に関連しています。 traditionally、フロントエンドは JavaScript/TypeScript で記述されてきました。

`Leptos` は、この常識を覆し、WebAssembly (WASM) を活用して、Web サイトのフロントエンドとサーバーサイドの両方を Rust で開発できるようにするフレームワークです。

- **単一言語**: バックエンドとフロントエンドで同じ言語、型システム、ツールチェーンを共有できます。
- **パフォーマンス**: サーバーサイドレンダリング (SSR) とクライアントサイドの細かいリアクティビティを組み合わせ、高速な初期表示と豊かなインタラクションを実現します。
- **型安全性**: Rust の静的型付けの恩恵をフロントエンド開発にもたらし、多くのランタイムエラーを防ぎます。

この章では、`Leptos` を使って、最も基本的なインタラクティブな Web アプリケーションを作成します。

## 32.2 プロジェクトの準備
`Leptos` の開発には `cargo-leptos` というツールが便利です。

```bash
# cargo-leptos のインストール
cargo install cargo-leptos
# プロジェクトの作成
cargo leptos new fullstack-app
cd fullstack-app
```
`cargo leptos new` は、サーバーサイドとクライアントサイドのコードを含む完全なプロジェクトの雛形を生成します。

## 32.3 コンポーネントとリアクティビティ
`Leptos` の UI は、**コンポーネント**の組み合わせで構築されます。コンポーネントは `#[component]` 属性を付けた、HTML に似た `view!` マクロを返す関数です。

インタラクティブな状態は**シグナル** (`create_signal`) を使って管理します。シグナルが更新されると、そのシグナルを使っている UI の部分だけが自動的に再描画されます。

```rust
// src/app.rs
use leptos::*;

#[component]
pub fn App() -> impl IntoView {
    // let (count, set_count) = create_signal(0);
    // 最初の引数が読み取り用、2番目が書き込み用のセッター
    let (count, set_count) = create_signal(cx, 0);

    view! { cx,
        <h1>"Welcome to Leptos!"</h1>
        <button
            // on:click 属性でイベントハンドラを設定
            on:click=move |_| {
                // set_count を呼んでシグナルの値を更新
                set_count.update(|n| *n += 1);
            }
        >
            // count() でシグナルの値を読み取る
            "Click me: " {move || count.get()}
        </button>
    }
}
```

## 32.4 開発サーバーの起動
プロジェクトのルートで `cargo leptos watch` を実行すると、開発サーバーが起動します。

ブラウザで `http://127.0.0.1:3000` にアクセスすると、カウンターアプリケーションが表示されます。ボタンをクリックすると、WASM としてブラウザで実行されている Rust コードが状態を更新し、表示が変更されることを確認できます。

ページのソースを表示すると、最初の HTML がサーバー側で生成されていること (SSR) も確認できます。

## 32.5 まとめ
- `Leptos` は、サーバーサイドとクライアントサイドの両方を Rust で開発できるフルスタック Web フレームワークです。
- `cargo-leptos` を使うことで、プロジェクトのセットアップが簡単に行えます。
- UI は `#[component]` を付けた関数の組み合わせで構築し、`view!` マクロで見た目を記述します。
- `create_signal` で作成したシグナルを使って状態を管理することで、効率的な UI の更新（リアクティビティ）が実現されます。

---
`Leptos` は、Rust のエコシステムを Web 全体に広げる可能性を秘めています。次の第7部では、さらに Rust の能力を深く引き出すための、より発展的なトピックを探求します。
